<%- include('../partials/head', { title: 'Revenue Management - SeekoBharat' }) %>
<body class="bg-black text-white">
  <%- include('../partials/navbar') %>

  <div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">Revenue Management</h1>
    
    <!-- Revenue Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <!-- Total Revenue Card -->
      <div class="bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-sm font-medium text-gray-400 mb-1">Total Revenue</h2>
        <p class="text-3xl font-bold text-white">$<%= totalRevenue.toLocaleString() %></p>
        <p class="text-xs text-gray-500 mt-1">Lifetime earnings</p>
      </div>
      
      <!-- Monthly Revenue Card -->
      <div class="bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-sm font-medium text-gray-400 mb-1">Monthly Revenue</h2>
        <p class="text-3xl font-bold text-white">$<%= (monthlyRevenue || 0).toLocaleString() %></p>
        <p class="text-xs text-gray-500 mt-1">Current month</p>
      </div>
      
      <!-- Instructor Payouts Card -->
      <div class="bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-sm font-medium text-gray-400 mb-1">Instructor Payouts</h2>
        <p class="text-3xl font-bold text-white">$<%= ((monthlyRevenue || 0) * 0.7).toLocaleString() %></p>
        <p class="text-xs text-gray-500 mt-1">70% of monthly revenue</p>
      </div>
    </div>
    
    <!-- Charts Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- Revenue by Month Chart -->
      <div class="bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <div class="p-4 border-b border-gray-700">
          <h2 class="text-lg font-semibold text-gray-100">Revenue by Month</h2>
        </div>
        <div class="p-6">
          <div class="h-80">
            <canvas id="revenue-chart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Revenue by Category Chart -->
      <div class="bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <div class="p-4 border-b border-gray-700">
          <h2 class="text-lg font-semibold text-gray-100">Revenue by Category</h2>
        </div>
        <div class="p-6">
          <div class="h-80">
            <canvas id="category-chart"></canvas>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Recent Transactions Table -->
    <div class="bg-gray-800 rounded-lg shadow-md overflow-hidden">
      <div class="p-4 border-b border-gray-700">
        <h2 class="text-lg font-semibold text-gray-100">Recent Transactions</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-700">
          <thead class="bg-gray-700">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Order ID</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">User</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Course</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Amount</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
            </tr>
          </thead>
          <tbody class="bg-gray-800 divide-y divide-gray-700">
            <% recentOrders.forEach(function(order) { %>
              <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">
                  <%= order.id %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-8 w-8 rounded-full bg-gray-700 flex items-center justify-center">
                      <span class="text-gray-400 font-medium"><%= order.userName.charAt(0) %></span>
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-100"><%= order.userName %></div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                  <%= order.courseTitle %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-100">
                  $<%= order.amount.toFixed(2) %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                  <%= new Date(order.createdAt).toLocaleDateString() %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-600 text-green-200">
                    <%= order.status.charAt(0).toUpperCase() + order.status.slice(1) %>
                  </span>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <div class="px-6 py-4 bg-gray-700 flex justify-between items-center">
        <div class="text-sm text-gray-300">
          Showing <span class="font-medium"><%= recentOrders.length %></span> transactions
        </div>
        <a href="/admin/revenue/transactions" class="text-blue-400 hover:text-blue-300">
          View All Transactions
        </a>
      </div>
    </div>
  </div>

  <%- include('../partials/footer') %>
  <%- include('../partials/scripts') %>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Revenue by Month Chart
      const revenueCtx = document.getElementById('revenue-chart').getContext('2d');
      const revenueChart = new Chart(revenueCtx, {
        type: 'bar',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          datasets: [{
            label: 'Revenue ($)',
            data: [
              <%= chartData.map(function(month) { return month.revenue; }).join(', ') %>
            ],
            backgroundColor: '#3b82f6', // Blue-500
            borderColor: '#2563eb', // Blue-600
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: '#d1d5db', // Gray-300
                callback: function(value) {
                  return '$' + value.toLocaleString();
                }
              },
              grid: {
                color: '#374151' // Gray-700
              }
            },
            x: {
              ticks: {
                color: '#d1d5db' // Gray-300
              },
              grid: {
                color: '#374151' // Gray-700
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: '#d1d5db' // Gray-300
              }
            }
          }
        }
      });
      
      // Revenue by Category Chart
      const categoryCtx = document.getElementById('category-chart').getContext('2d');
      const categoryChart = new Chart(categoryCtx, {
        type: 'pie',
        data: {
          labels: [
            <% categoryRevenue.forEach(function(category) { %>
              '<%= category.name %>',
            <% }); %>
          ],
          datasets: [{
            label: 'Revenue by Category',
            data: [
              <% categoryRevenue.forEach(function(category) { %>
                <%= category.revenue %>,
              <% }); %>
            ],
            backgroundColor: [
              '#3b82f6', // Blue-500
              '#10b981', // Green-500
              '#ef4444', // Red-500
              '#f59e0b', // Yellow-500
              '#8b5cf6', // Purple-500
              '#14b8a6', // Teal-500
              '#4b5563', // Gray-600
              '#9ca3af'  // Gray-400
            ],
            borderWidth: 1,
            borderColor: '#1f2937' // Gray-800
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                color: '#d1d5db' // Gray-300
              }
            }
          }
        }
      });
    });
  </script>
</body>
</html>